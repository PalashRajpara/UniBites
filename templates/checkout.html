{% extends "base.html" %}

{% block title %}Checkout - UNIBITES{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Checkout</h2>
  
  <div class="row">
    <div class="col-md-8">
      <h4>Order Summary</h4>
      <table class="table">
        <thead>
          <tr>
            <th>Item</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {% for item, product in cart_items %}
          <tr>
            <td>{{ product.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>₹{{ product.price }}</td>
            <td>₹{{ (product.price * item.quantity) | round(2) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      
      <h4 class="mt-4">Delivery Details</h4>
      <form id="checkout-form">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label>Full Name</label>
              <input type="text" class="form-control" value="{{ current_user.username }}" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label>Phone Number</label>
              <input type="tel" class="form-control" placeholder="+91 9876543210" required>
            </div>
          </div>
        </div>
        
        <div class="form-group mb-3">
          <label>Delivery Address</label>
          <textarea class="form-control" rows="3" placeholder="Enter your complete address" required></textarea>
        </div>
      </form>
    </div>
    
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h5>Payment Summary</h5>
          <div class="d-flex justify-content-between">
            <span>Subtotal:</span>
            <span>₹{{ total | round(2) }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Delivery Fee:</span>
            <span>₹20.00</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Tax:</span>
            <span>₹{{ (total * 0.05) | round(2) }}</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between">
            <strong>Total:</strong>
            <strong>₹{{ (total + 20 + (total * 0.05)) | round(2) }}</strong>
          </div>
          
          <h6 class="mt-3">Payment Method</h6>
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="payment" id="card" checked>
            <label class="form-check-label" for="card">
              <i class="fas fa-credit-card"></i> Credit/Debit Card
            </label>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="payment" id="upi">
            <label class="form-check-label" for="upi">
              <i class="fab fa-google-pay"></i> UPI Payment
            </label>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" name="payment" id="cod">
            <label class="form-check-label" for="cod">
              <i class="fas fa-money-bill-wave"></i> Cash on Delivery
            </label>
          </div>
          
          <button id="place-order-btn" class="btn btn-success btn-block w-100">
            <i class="fas fa-shopping-bag"></i> Place Order
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Payment Processing Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <div class="spinner-border text-primary mb-3" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <h5>Processing Payment...</h5>
        <p>Please wait while we process your payment securely.</p>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('place-order-btn').addEventListener('click', function() {
  // Show processing modal
  var modal = new bootstrap.Modal(document.getElementById('paymentModal'));
  modal.show();
  
  // Simulate payment processing
  setTimeout(function() {
    // Submit form to process payment
    var form = document.createElement('form');
    form.method = 'POST';
    form.action = "{{ url_for('process_payment') }}";
    document.body.appendChild(form);
    form.submit();
  }, 3000); // 3 second delay to simulate processing
});
</script>
{% endblock %}
